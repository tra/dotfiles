{"mode":"editor","version":1,"windowDimensions":{"x":919,"y":22,"width":1440,"height":878},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"path":"/Users/tra/src/advanced-apps/aa-monitor","buffers":[{"text":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width\">\n    <meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\n    <link rel=\"apple-touch-icon\" href=\"/res/icon/ios/icon-76-2x.png\">\n    <title>Advanced Apps Mobile Monitor</title>\n\n    <!-- build:css styles/vendor.css -->\n    <!-- <link rel=\"stylesheet\" href=\"vendor/some.contrib.css\"> -->\n    <!-- bower:css -->\n    <link rel=\"stylesheet\" href=\"bower_components/ionic/release/css/ionic.css\" />\n    <!-- endbower -->\n    <!-- endbuild -->\n\n    <!-- build:css({.tmp,app}) styles/main.css -->\n    <link rel=\"stylesheet\" href=\"styles/main.css\">\n    <!-- endbuild -->\n  </head>\n\n  <body ng-app=\"AaMobileMonitor\">\n    <ion-nav-view></ion-nav-view>\n\n    <!-- build:js scripts/vendor.js -->\n    <!-- <script src=\"vendor/someContribJs.js\"></script> -->\n    <!-- bower:js -->\n    <script src=\"bower_components/jquery/dist/jquery.js\"></script>\n    <script src=\"bower_components/d3/d3.js\"></script>\n    <script src=\"bower_components/underscore/underscore.js\"></script>\n    <script src=\"bower_components/rfc6570/rfc6570.js\"></script>\n    <script src=\"bower_components/angular/angular.js\"></script>\n    <script src=\"bower_components/angular-hal/angular-hal.js\"></script>\n    <script src=\"bower_components/angular-animate/angular-animate.js\"></script>\n    <script src=\"bower_components/angular-sanitize/angular-sanitize.js\"></script>\n    <script src=\"bower_components/angular-ui-router/release/angular-ui-router.js\"></script>\n    <script src=\"bower_components/ionic/release/js/ionic.js\"></script>\n    <script src=\"bower_components/ionic/release/js/ionic-angular.js\"></script>\n    <!-- endbower -->\n    <!-- endbuild -->\n\n    <!-- build:js({.tmp,app}) scripts/scripts.js -->\n    <script src=\"scripts/app.js\"></script>\n\n    <script src=\"scripts/services/predicted_load_service.js\"></script>\n    <script src=\"scripts/services/actual_load_service.js\"></script>\n    <script src=\"scripts/services/aggregated_load_service.js\"></script>\n    <script src=\"scripts/services/registration_service.js\"></script>\n    <script src=\"scripts/services/directory_service.js\"></script>\n    <script src=\"scripts/services/auth_service.js\"></script>\n    <script src=\"scripts/services/chart_control_service.js\"></script>\n\n    <script src=\"scripts/filters/number_to_words_filter.js\"></script>\n    <script src=\"scripts/filters/between_times_filter.js\"></script>\n    <script src=\"scripts/filters/normalize_series_filter.js\"></script>\n    <script src=\"scripts/filters/capitalize_filter.js\"></script>\n\n    <script src=\"scripts/controllers/dashboard_controller.js\"></script>\n\n    <script src=\"scripts/controllers/login_controller.js\"></script>\n    <script src=\"scripts/controllers/chart_controller.js\"></script>\n    <script src=\"scripts/controllers/chart_container_controller.js\"></script>\n    <script src=\"scripts/controllers/micro_chart_controller.js\"></script>\n    <script src=\"scripts/controllers/micro_chart_container_controller.js\"></script>\n    <script src=\"scripts/controllers/load_forecast_controller.js\"></script>\n\n    <!-- endbuild -->\n\n    <!-- cordova script (this will be a 404 during development) -->\n    <script src=\"cordova.js\"></script>\n\n  </body>\n</html>\n","markers":{"markers":{"1":{"id":1,"range":[[5,22],[5,28]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":37,"goalBufferRange":null},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"oldRange":[[5,0],[5,0]],"newRange":[[5,0],[6,0]],"oldText":"","newText":"\n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[6,0],[6,0]],"newRange":[[6,0],[6,0]],"oldText":"","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,0],[5,0]],"newRange":[[5,0],[5,56]],"oldText":"","newText":"<meta name=\"apple-mobile-web-app-capable\" content=\"yes\">","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,0],[5,0]],"newRange":[[5,0],[5,1]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,1],[5,1]],"newRange":[[5,1],[5,2]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,2],[5,2]],"newRange":[[5,2],[5,3]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,3],[5,3]],"newRange":[[5,3],[5,4]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,60],[5,60]],"newRange":[[5,60],[6,0]],"oldText":"","newText":"\n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[6,0],[6,0]],"newRange":[[6,0],[6,4]],"oldText":"","newText":"    ","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[6,4],[6,4]],"newRange":[[6,4],[6,68]],"oldText":"","newText":"<link rel=\"apple-touch-icon\" href=\"apple-touch-icon-iphone.png\">","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[6,39],[6,66]]},"newParams":{"tailed":false,"range":[[6,66],[6,66]]},"deserializer":"MarkerPatch"},{"oldRange":[[6,39],[6,66]],"newRange":[[6,39],[6,67]],"oldText":"apple-touch-icon-iphone.png","newText":"/res/icon/ios/icon-76-2x.png","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"filePath":"/Users/tra/src/advanced-apps/aa-monitor/app/index.html","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"83f812ee14c76d2cb7d7399500fbbc189c36996a","deserializer":"TextBuffer"},{"text":"angular.module('AaMobileMonitor').controller('ChartController', ['$scope', 'ChartControlService', 'AggregatedLoadService', function($scope, chart_control_service, aggregated_load_service) {\n  chart_control_service.chart_scope = $scope;\n\n  var margin = {\n    top: 20,\n    right: 20,\n    bottom: 30,\n    left: 50\n  };\n\n  var width  = window.innerWidth - 20 - margin.left - margin.right;\n  var height = 410 - margin.top  - margin.bottom;\n\n  $scope.x = d3.time.scale().range([0, width]);\n  $scope.y = d3.scale.linear().range([height, 0]);\n\n  $scope.color = d3.scale.ordinal().range([\"#0aa8cb\",\"#f9941d\"]);\n  $scope.color.domain([\"Actual Load\", \"Projected Load\"]);\n\n  $scope.x_axis = d3.svg.axis()\n    .scale($scope.x)\n    .ticks(24)\n    .orient('bottom');\n\n  $scope.y_axis = d3.svg.axis()\n    .scale($scope.y)\n    .ticks(8)\n    .orient('left');\n\n  $scope.line = d3.svg.line()\n    .x(function(d) { return $scope.x(d.date); })\n    .y(function(d) { return $scope.y(d.value); });\n\n  var tip_dimensions = {\n    width: 140,\n    height: 60,\n    offset: 20,\n    xmargin: 10,\n    ymargin: -10\n  };\n\n  $scope.tool_tip_active = false;\n\n  $scope.calculate_tooltip_location = function() {\n    var x_value = d3.event.layerX - margin.right - margin.left;\n    var point = aggregated_load_service.get_point_for_date( $scope.x.invert(x_value) );\n\n    var y_point = $scope.y(point.value);\n    var x_point = $scope.x(point.date);\n\n    var x_location = x_point - (tip_dimensions.width + tip_dimensions.offset);\n    if (x_location < 0) {\n      x_location = d3.max( [x_point + tip_dimensions.offset, tip_dimensions.offset] );\n    }\n\n    var y_location = d3.max([y_point, (tip_dimensions.height / 2) - tip_dimensions.ymargin]);\n    y_location = d3.min([y_location, height - (tip_dimensions.height / 2) + tip_dimensions.ymargin]);\n\n    return  {\n      x_location: x_location,\n      y_location: y_location,\n      point: {\n        date: point.date,\n        value: point.value,\n        x: x_point,\n        y: y_point\n      }\n    }\n  };\n\n  $scope.tool_tip_pressed = function() {\n    if ( !$scope.chart.selectAll('g.tooltip').empty() ) return;\n\n    $scope.tool_tip_active = true;\n\n    $scope.tip_container = $scope.chart.append('g')\n      .attr(\"class\", \"tooltip\")\n      .attr('clip-path', 'url(#clip)');\n\n    $scope.tip_container.append(\"rect\")\n      .attr(\"class\", \"tip-message\")\n      .attr(\"rx\", 2)\n      .attr(\"ry\", 2)\n      .attr(\"width\", tip_dimensions.width)\n      .attr(\"height\", tip_dimensions.height);\n\n    $scope.tip_container.append(\"text\")\n      .attr(\"class\", \"date-point\")\n      .style(\"text-anchor\", \"start\");\n\n    $scope.tip_container.append(\"text\")\n      .attr(\"class\", \"load-value\")\n      .style(\"text-anchor\", \"start\");\n\n    $scope.tip_container.append(\"line\")\n      .attr(\"class\", \"tipline\")\n      .attr('y1', 0)\n      .attr('y2', height);\n\n    $scope.tip_container.append(\"circle\")\n      .attr(\"class\", \"connecting-point\")\n      .attr('clip-path', 'url(#clip)')\n      .attr(\"r\", 8);\n\n    $scope.tool_tip_moving();\n  };\n\n  $scope.tool_tip_released = function() {\n    $scope.tool_tip_active = false;\n    $scope.chart.selectAll(\"g.tooltip\").remove();\n  };\n\n  $scope.tool_tip_moving = function() {\n    if ($scope.tool_tip_active) {\n      var metrics = $scope.calculate_tooltip_location();\n\n      $scope.tip_container.select(\"rect.tip-message\")\n        .attr(\"y\", metrics.y_location - (tip_dimensions.height / 2))\n        .attr(\"x\", metrics.x_location);\n\n      $scope.tip_container.select(\"text.date-point\")\n        .text(d3.time.format(\"%Y-%m-%d %I:%M %p\")(metrics.point.date))\n        .attr(\"x\", metrics.x_location + tip_dimensions.xmargin)\n        .attr(\"y\", metrics.y_location + tip_dimensions.ymargin);\n\n      var color_klass = (new Date() > metrics.point.date) ? \"actual\" : \"predicted\";\n\n      $scope.tip_container.select(\"text.load-value\")\n        .attr(\"class\", \"load-value \" + color_klass)\n        .text(\"Load: \" + d3.round(metrics.point.value, 0) + \" MW\")\n        .attr(\"x\", metrics.x_location + tip_dimensions.xmargin)\n        .attr(\"y\", metrics.y_location + tip_dimensions.ymargin + 20);\n\n      $scope.chart.select('line.tipline')\n        .attr('x1', metrics.point.x)\n        .attr('x2', metrics.point.x);\n\n      $scope.tip_container.select(\"circle.connecting-point\")\n        .attr(\"class\", \"connecting-point \" + color_klass)\n        .attr(\"cx\", metrics.point.x)\n        .attr(\"cy\", metrics.point.y);\n    }\n  };\n\n  $scope.create_chart = function(element) {\n    $scope.chart = d3.select(element[0])\n      .attr('width', width + margin.left + margin.right)\n      .attr('height', height + margin.top + margin.bottom)\n      .on('mousedown', $scope.tool_tip_pressed)\n      .on('touchstart', $scope.tool_tip_pressed)\n      .on('mouseup', $scope.tool_tip_released)\n      .on('touchend', $scope.tool_tip_released)\n      .on('mousemove', $scope.tool_tip_moving)\n      .on('touchmove', $scope.tool_tip_moving)\n      .append('g')\n      .attr('transform', 'translate(' + (margin.left + 20) + ',' + margin.top + ')');\n\n    $scope.chart.append('clipPath')\n      .attr('id', 'clip')\n      .append('rect')\n      .attr('x', 0)\n      .attr('y', 0)\n      .attr('width', width)\n      .attr('height', height);\n\n    $scope.chart.append('g')\n      .attr('class', 'y axis')\n      .call($scope.y_axis.tickSize(-width, 0, 0))\n      .append('text')\n      .attr('transform', 'rotate(-90)')\n      .attr('y', -60)\n      .attr('x', -120)\n      .attr('dy', '.71em')\n      .style('text-anchor', 'end')\n      .text('Megawatts (MW)');\n\n    $scope.chart.append('g')\n      .attr('class', 'x axis')\n      .attr('transform', 'translate(0,' + height + ')')\n      .call($scope.x_axis.tickSize(-height, 0, 0));\n\n    $scope.chart\n      .append(\"g\")\n      .attr(\"class\", \"load\");\n\n    aggregated_load_service.get_all_loads().then( function(service) {\n      $scope.update_chart( service.grouped_loads(), true );\n    });\n  };\n\n  $scope.update_chart = function(loads, default_range) {\n    default_range = default_range || false;\n\n    $scope.y.domain( d3.extent(aggregated_load_service.combined_load, function(d) { return d.value; }) );\n\n    if (default_range) {\n      $scope.x.domain( aggregated_load_service.initial_two_day_spread() );\n    } else {\n      chart_control_service.update_chart_focus();\n    }\n\n    $scope.load_lines = $scope.chart\n      .selectAll(\"g.load\")\n      .selectAll(\"path.line\");\n\n    $scope.load_lines\n      .data(loads)\n      .enter()\n      .append('path')\n      .attr('class', 'line')\n      .attr('clip-path', 'url(#clip)')\n      .attr('d', function(d) { return $scope.line( d.values ); })\n      .style(\"stroke\", function(d) { return $scope.color( d.name ); });\n\n    $scope.chart.select('.x.axis').call($scope.x_axis);\n    $scope.chart.select('.y.axis').call($scope.y_axis);\n  };\n\n}]).directive('setupChart', function() {\n  return {\n    restrict: 'EA',\n    link: function(scope, element, attrs) {\n      scope.create_chart(element, attrs);\n    }\n  };\n});\n","markers":{"markers":{"1":{"id":1,"range":[[11,18],[11,18]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":59,"autoscroll":true,"goalBufferRange":null},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[11,15],[11,18]]},"newParams":{"tailed":false,"range":[[11,18],[11,18]]},"deserializer":"MarkerPatch"},{"oldRange":[[11,15],[11,18]],"newRange":[[11,15],[11,16]],"oldText":"340","newText":"4","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,16],[11,16]],"newRange":[[11,16],[11,17]],"oldText":"","newText":"1","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,17],[11,17]],"newRange":[[11,17],[11,18]],"oldText":"","newText":"0","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"filePath":"/Users/tra/src/advanced-apps/aa-monitor/app/scripts/controllers/chart_controller.js","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"317785f5f6530a5d505312409532571fa9c6a4e0","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"items":[{"id":37,"softTabs":true,"displayBuffer":{"id":38,"softWrap":false,"editorWidthInChars":115,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/tra/src/advanced-apps/aa-monitor/app/index.html","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"},{"id":59,"softTabs":true,"displayBuffer":{"id":60,"softWrap":false,"editorWidthInChars":110,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/tra/src/advanced-apps/aa-monitor/app/scripts/controllers/chart_controller.js","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"/Users/tra/src/advanced-apps/aa-monitor/app/index.html","focused":false,"active":true,"deserializer":"Pane"},"deserializer":"PaneContainer"},"fullScreen":false,"deserializer":"Workspace"},"packageStates":{"find-and-replace":{"viewState":{"findHistory":["height"],"replaceHistory":[],"modelState":{"useRegex":false,"inCurrentSelection":false,"caseSensitive":false}}},"fuzzy-finder":{"/Users/tra/src/advanced-apps/aa-monitor/app/index.html":1400613852197,"/Users/tra/src/advanced-apps/aa-monitor/app/scripts/controllers/chart_controller.js":1400613849313},"keybinding-resolver":{"attached":false},"metrics":{"sessionLength":774388548},"tree-view":{"directoryExpansionStates":{"app":{"styles":{},"templates":{}},"www":{}},"selectedPath":"/Users/tra/src/advanced-apps/aa-monitor/app/index.html","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":100}}}